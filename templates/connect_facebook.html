<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhatsApp Login</title>
</head>
<body>

  <!-- WhatsApp Login Button -->
  <button id="wa-login-btn" 
          style="background-color: #25D366; border: 0; border-radius: 4px; color: #fff; cursor: pointer; font-family: Helvetica, Arial, sans-serif; font-size: 16px; font-weight: bold; height: 40px; padding: 0 24px;">
    Login with WhatsApp
  </button>

  <!-- Load Facebook SDK -->
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

  <script>
    // Initialize SDK
    window.fbAsyncInit = function() {
      FB.init({
        appId: '3184250695088317',   // Your App ID
        autoLogAppEvents: true,
        xfbml: true,
        version: 'v19.0'             // Graph API version
      });
      console.log('FB SDK Initialized');
    };

    // Listen for embedded signup messages (optional)
    window.addEventListener('message', (event) => {
      if (!event.origin.endsWith('facebook.com')) return;
      try {
        const data = JSON.parse(event.data);
        if (data.type === 'WA_EMBEDDED_SIGNUP') {
          console.log('Message Event:', data);
        }
      } catch {
        console.log('Message Event:', event.data);
      }
    });

    // Callback after WhatsApp login
    const fbLoginCallback = (response) => {
  if (response.authResponse && response.authResponse.code) {
    const code = response.authResponse.code;
    console.log('Login Code:', code);

    // Send code to backend
    fetch('https://test.frontliner.io/api/social/whatsapp/callback/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code: code }) // send "code", not access_token
    })
    .then(res => res.json())
    .then(data => console.log('Backend Response:', data))
    .catch(err => console.error('Error:', err));
  } else {
    console.log('Login failed or code not returned:', response);
  }
};

    // Launch WhatsApp login
    const launchWhatsAppSignup = () => {
      FB.login(fbLoginCallback, {
        config_id: '3483969311755010', // Your Configuration ID
        response_type: 'code',
        override_default_response_type: true,
        extras: { setup: {} }
      });
    };

    // Attach click listener
    document.getElementById('wa-login-btn').addEventListener('click', launchWhatsAppSignup);
  </script>

</body>
</html>
